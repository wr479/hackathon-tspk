class ElemQuery{constructor(e){this.query=e.query,this.value=e.value}}class QueryFilter{constructor(e,t){this.$Elems="string"==typeof e?document.querySelectorAll(`${e}`):e,this.$confirmButton="string"==typeof t.confirmButton?document.querySelectorAll(`${t.confirmButton}`):t.confirmButton,this.$cancelButton="string"==typeof t.cancelButton?document.querySelectorAll(`${t.cancelButton}`):t.cancelButton,this.options=t||{},this.debounced=t.debounced,this.pagination=t.pagination,this.search=t.search,!this.pagination||this.search?!this.search||this.pagination?0===this.$Elems.length||this.pagination||(this.filtersFunctionary(),this.filterButtonsFunctionary()):this.searcherFunctionary():this.paginationFunctionary()}filtersFunctionary(){const e=getCurrentQuery();for(const t of this.$Elems){const n=new ElemQuery({query:t.dataset.query,value:t.dataset.value}),r=document.querySelectorAll(`.${t.className}[data-query="${n.query}"]`),u=document.querySelector(`.${t.className}[data-query="${n.query}"][data-value=""]`);u&&(0!==e.length&&e.find((e=>e[n.query]))&&!e.some((e=>""===e[n.query]))||(u.checked=!0)),e.map((e=>{e[`${n.query}`]===n.value&&(t.checked=!0)})),t.addEventListener("click",(()=>{let e=!1;for(const n of r)if(t==u){for(const e of r)e!==u&&(e.checked=!1);t.checked=!0}else u&&n!==u&&n.checked&&(u.checked=!1,e=!0);if(!e&&u&&(u.checked=!0),!this.debounced||this.$confirmButton)return;const n=this.getActiveFilters();debouncedSetNewQuery(n)}))}}filterButtonsFunctionary(){if(this.$confirmButton&&!this.debounced&&!this.search)for(const e of this.$confirmButton)e.addEventListener("click",(()=>{setNewQuery(this.getActiveFilters())}));if(this.$cancelButton&&this.$cancelButton.length>0)for(const e of this.$cancelButton)e.addEventListener("click",(()=>{setNewQuery([])}))}paginationFunctionary(){const e=getCurrentQuery(),t=this.filterCurrentQuery("page");for(const n of this.$Elems)e.map((e=>{e.page===n.dataset.value&&(n.checked=!0)})),n.addEventListener("click",(()=>{const e=new ElemQuery({query:"page",value:n.dataset.value});t.push(e),setNewQuery(t)}))}searcherFunctionary(){const e=getCurrentQuery();for(const t of this.$Elems){const n=t.form;e.map((e=>{e[`${t.dataset.query}`]&&(t.value=e[`${t.dataset.query}`])}));let r=this.filterCurrentQuery(t.dataset.query);t.addEventListener("input",(()=>{const e=new ElemQuery({query:t.dataset.query,value:t.value});r=r.filter((t=>t.query!==e.query)),r.push(e),this.debounced&&debouncedSetNewQuery(r)})),n&&n.addEventListener("submit",(e=>{e.preventDefault(),setNewQuery(r)}))}}filterCurrentQuery(e){const t=getCurrentQuery(),n=[];return t.map((t=>{if(!t[`${e}`]){const[[e,r]]=Object.entries(t),u=new ElemQuery({query:e,value:r});n.push(u)}})),n}getActiveFilters(){const e=[];for(const t of this.$Elems)if(t.checked&&""!==t.dataset.value){const n=new ElemQuery({query:t.dataset.query,value:t.dataset.value});e.push(n)}return e}}const debouncedSetNewQuery=debounce(setNewQuery,1e3);function setNewQuery(e){const t=new URLSearchParams;e.length>0&&Array.isArray(e)&&e.forEach((e=>{t.append(e.query,e.value)})),window.location.search=t.toString()}function getCurrentQuery(){const e=new URLSearchParams(window.location.search),t=[];for(let n of e.entries()){const e={};let r=n[0],u=n[1];e[`${r}`]=u,t.push(e)}return t}function debounce(e,t){let n;return function(){const r=this,u=arguments;clearTimeout(n),n=setTimeout((function(){e.apply(r,u)}),t)}}export default QueryFilter;